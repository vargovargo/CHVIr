names9intersect
names(intersect)
intersect$leb
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.) %>%
ggplot() +
geom_point(aes(x=total, y=leb)) +
geom_smooth(aes(x=total, y=leb), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.) %>%
ggplot() +
geom_point(aes(x=goods, y=leb)) +
geom_smooth(aes(x=total, y=leb), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.) %>%
ggplot() +
geom_point(aes(x=transport, y=leb)) +
geom_smooth(aes(x=total, y=leb), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.) %>%
ggplot() +
geom_point(aes(x=transport, y=leb)) +
geom_smooth(aes(x=transport, y=leb), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(x=popden, y=emissions, color=Category)) +
geom_smooth(aes(x=popden, y=emissions, color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(x=popden, y=emissions, color=Category)) +
geom_smooth(aes(x=popden, y=emissions, color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(x=leb, y=emissions, color=Category)) +
geom_smooth(aes(x=leb, y=emissions, color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions, color=Category)) +
geom_smooth(aes(y=leb, x=emissions, color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. Life Expectancy at Birth")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions/HouseholdsPerZipCode, color=Category)) +
geom_smooth(aes(y=leb, x=emissions/HouseholdsPerZipCode, color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. Life Expectancy at Birth")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=log(emissions/HouseholdsPerZipCode), color=Category)) +
geom_smooth(aes(y=leb, x=log(emissions/HouseholdsPerZipCode), color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. Life Expectancy at Birth")
View(GHG)
View(intersect)
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions*HouseholdsPerZipCode, color=Category)) +
geom_smooth(aes(y=leb, x=emissions*HouseholdsPerZipCode, color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. Life Expectancy at Birth")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=log(emissions*HouseholdsPerZipCode), color=Category)) +
geom_smooth(aes(y=leb, x=log(emissions*HouseholdsPerZipCode), color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("Total Carbon Emissions vs. Life Expectancy at Birth")
runApp('GitHub/CHVIr/CHIViz')
shiny::runApp('GitHub/CHVIr/CHIViz')
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse)
library(sf)
library(ggthemes)
health <- read.csv("~/GHG_leb/HPIhealthOutcomes.csv", header=T) %>%
mutate(ct10= as.character(paste0("0",geoid)))
GHG <- read.csv("~/GHG_leb/CoolClimateZips.csv", header=T, stringsAsFactors = FALSE)
head(health)
head(GHG)
GHG %>% filter(State == "CA") %>%
ggplot() +
geom_point(aes(x=popden, y=Vehicle.miles.traveled)) +
geom_smooth(aes(x=popden, y=Vehicle.miles.traveled), method = "loess") +
theme_fivethirtyeight() + ggtitle("VMT vs PopDensity")
GHG %>% filter(State == "CA") %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.) %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(x=popden, y=emissions, color=Category)) +
geom_smooth(aes(x=popden, y=emissions, color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCapita Carbon Emissions vs. PopDensity")
tracts <- st_read("~/CHVI_copy/data/shapefiles/census_tracts2010.shp") %>%
st_transform(crs = 4326) %>%
left_join(health)
GHGpt <- st_as_sf(GHG, coords = c("Longitude", "Latitude"), crs = 4326)
intersect <- st_intersection(x = tracts, y =GHGpt)
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions, color=Category, alpha=0.3)) +
geom_smooth(aes(y=leb, x=emissions, color=Category, group= Category)) +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCap CO2equiv vs. Life Expectancy")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=log(emissions*HouseholdsPerZipCode), color=Category)) +
geom_smooth(aes(y=leb, x=log(emissions*HouseholdsPerZipCode), color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("Total Carbon Emissions vs. Life Expectancy at Birth")
tracts <- st_read("~/CHVI_copy/data/shapefiles/census_tracts2010.shp") %>%
st_transform(crs = 4326) %>%
left_join(health)
GHGpt <- st_as_sf(GHG, coords = c("Longitude", "Latitude"), crs = 4326)
intersect <- st_intersection(x = tracts, y =GHGpt)
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions, color=Category, alpha=0.1)) +
geom_smooth(aes(y=leb, x=emissions, color=Category, group= Category)) +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCap CO2equiv vs. Life Expectancy")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=log(emissions*HouseholdsPerZipCode), color=Category)) +
geom_smooth(aes(y=leb, x=log(emissions*HouseholdsPerZipCode), color=Category, group= Category), method = "glm") +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("Total Carbon Emissions vs. Life Expectancy at Birth")
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions, color=Category, alpha=0.1)) +
geom_smooth(aes(y=leb, x=emissions, color=Category, group= Category)) +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCap CO2equiv vs. Life Expectancy") + facet_wrap(~ Category)
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions, color=Category, alpha=0.1, size=0.2)) +
geom_smooth(aes(y=leb, x=emissions, color=Category, group= Category)) +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCap CO2equiv vs. Life Expectancy") + facet_wrap(~ Category)
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions, color=Category, alpha=0.1, size=0.02)) +
geom_smooth(aes(y=leb, x=emissions, color=Category, group= Category)) +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCap CO2equiv vs. Life Expectancy") + facet_wrap(~ Category)
intersect %>%
rename(transport = Transport..tCO2e.yr.,
housing = Housing..tCO2e.yr.,
food = Food..tCO2e.yr.,
goods =  Goods..tCO2e.yr.,
services = Services..tCO2e.yr.,
total = Total..tCO2e.yr.)  %>%
gather(transport, housing, food, goods, services, total, key = "Category",value = "emissions") %>%
filter(Category != "total") %>%
ggplot() +
geom_point(aes(y=leb, x=emissions, color=Category, alpha=0.05)) +
geom_smooth(aes(y=leb, x=emissions, color=Category, group= Category)) +
theme_fivethirtyeight() +
scale_colour_wsj() + ggtitle("PerCap CO2equiv vs. Life Expectancy") + facet_wrap(~ Category)
runApp('GitHub/CHVIr/CHIViz')
runApp('GitHub/CHVIr/CHIViz')
runApp('GitHub/CHVIr/CHIViz')
counties <- st_read("~/CHVI_copy/data/shapefiles/Counties2010.shp", stringsAsFactors = F) %>% st_transform(crs = 4326)
st_write(obj = counties, dsn = "counties.geojson")
st_write(obj = counties, dsn = "~/GitHub/CHVIr/CHIViz/counties.geojson")
st_write(obj = counties, dsn = "~/GitHub/CHVIr/CHIViz/counties.geojson")
st_write(obj = counties, dsn = "~/GitHub/CHVIr/CHIViz/counties.geojson", update = TRUE)
counties <- st_read("countie.geojson", stringsAsFactors = F) %>% st_transform(crs = 4326)
counties <- st_read("counties.geojson", stringsAsFactors = F) %>% st_transform(crs = 4326)
runApp('GitHub/CHVIr/CHIViz')
library(shiny)
library(tidyverse)
library(markdown)
library(leaflet)
library(shinythemes)
library(ggthemes)
library(sf)
links <-read.csv(url("https://raw.githubusercontent.com/vargovargo/CHVIr/master/CHPRlinks.csv"), header=T)
CHVIdata <- read.csv(url("https://raw.githubusercontent.com/vargovargo/CHVIr/master/chviCountyTidy.csv"), header=T)
counties <- st_read("counties.geojson", stringsAsFactors = F) %>% st_transform(crs = 4326)
counties <- st_read("~/GitHub/CHVIr/CHIViz/counties.geojson", stringsAsFactors = F) %>% st_transform(crs = 4326)
data58 <-  CHVIdata %>%
mutate(COUNTYFI_1 = as.character(COUNTYFI_1)) %>%
filter(def == input$ind) %>%
spread(key = metric, value = value) %>%
rename(
County = county,
Region = climReg,
Definition = def,
Mean = est) %>%
mutate(selected = ifelse(County == input$cnty, "yes", "no"))
runApp('GitHub/CHVIr/CHIViz')
View(counties)
data58 <- CHVIdata %>%
mutate(COUNTYFI_1 = as.character(COUNTYFI_1)) %>%
filter(def == "Percent of households with air conditioning") %>%
spread(key = metric, value = value) %>%
rename(
County = county,
Region = climReg,
Definition = def,
Mean = est) %>%
mutate(selected = ifelse(County == input$cnty, "yes", "no"))
library(shiny)
library(tidyverse)
library(markdown)
library(leaflet)
library(shinythemes)
library(ggthemes)
library(sf)
links <-read.csv(url("https://raw.githubusercontent.com/vargovargo/CHVIr/master/CHPRlinks.csv"), header=T)
CHVIdata <- read.csv(url("https://raw.githubusercontent.com/vargovargo/CHVIr/master/chviCountyTidy.csv"), header=T)
counties <- st_read("~/GitHub/CHVIr/CHIViz/counties.geojson", stringsAsFactors = F) %>% st_transform(crs = 4326)
data58 <- CHVIdata %>%
mutate(COUNTYFI_1 = as.character(COUNTYFI_1)) %>%
filter(def == "Percent of households with air conditioning") %>%
spread(key = metric, value = value) %>%
rename(
County = county,
Region = climReg,
Definition = def,
Mean = est) %>%
mutate(selected = ifelse(County == "Alameda", "yes", "no"))
})
County = county,
Region = climReg,
Definition = def,
Mean = est) %>%
mutate(selected = ifelse(County == "Alameda", "yes", "no"))
data58 <- CHVIdata %>%
mutate(COUNTYFI_1 = as.character(COUNTYFI_1)) %>%
filter(def == "Percent of households with air conditioning") %>%
spread(key = metric, value = value) %>%
rename(
County = county,
Region = climReg,
Definition = def,
Mean = est) %>%
mutate(selected = ifelse(County == "Alameda", "yes", "no"))
mapTemp %>%
leaflet()  %>%
addTiles() %>%
addPolygons(
color = "#444444",
weight = 1,
fillOpacity = 0.6,
fillColor = ~ pal(Mean),
popup = paste0("This is ",mapTemp$County," County")
) %>%
addLegend(
pal = pal,
values = ~ Mean,
opacity = 1,
title = input$ind
)
mapTemp <- left_join(counties, data58())
pal <- colorQuantile(
palette = "RdYlBu",
n = 5,
reverse = TRUE,
domain = mapTemp$Mean
)
mapTemp %>%
leaflet()  %>%
addTiles() %>%
addPolygons(
color = "#444444",
weight = 1,
fillOpacity = 0.6,
fillColor = ~ pal(Mean),
popup = paste0("This is ",mapTemp$County," County")
) %>%
addLegend(
pal = pal,
values = ~ Mean,
opacity = 1,
title = input$ind
)
}
mapTemp <- left_join(counties, data58())
pal <- colorQuantile(
palette = "RdYlBu",
n = 5,
reverse = TRUE,
domain = mapTemp$Mean
)
mapTemp %>%
leaflet()  %>%
addTiles() %>%
addPolygons(
color = "#444444",
weight = 1,
fillOpacity = 0.6,
fillColor = ~ pal(Mean),
popup = paste0("This is ",mapTemp$County," County")
) %>%
addLegend(
pal = pal,
values = ~ Mean,
opacity = 1,
title = input$ind
)
library(shiny)
library(tidyverse)
library(markdown)
library(leaflet)
library(shinythemes)
library(ggthemes)
library(sf)
links <-read.csv(url("https://raw.githubusercontent.com/vargovargo/CHVIr/master/CHPRlinks.csv"), header=T)
CHVIdata <- read.csv(url("https://raw.githubusercontent.com/vargovargo/CHVIr/master/chviCountyTidy.csv"), header=T)
counties <- st_read("~/GitHub/CHVIr/CHIViz/counties.geojson", stringsAsFactors = F) %>% st_transform(crs = 4326)
data58 <- CHVIdata %>%
mutate(COUNTYFI_1 = as.character(COUNTYFI_1)) %>%
filter(def == "Percent of households with air conditioning") %>%
spread(key = metric, value = value) %>%
rename(
County = county,
Region = climReg,
Definition = def,
Mean = est) %>%
mutate(selected = ifelse(County == "Alameda", "yes", "no"))
mapTemp <- left_join(counties, data58
pal <- colorQuantile(
palette = "RdYlBu",
n = 5,
reverse = TRUE,
domain = mapTemp$Mean
)
mapTemp %>%
leaflet()  %>%
addTiles() %>%
addPolygons(
color = "#444444",
weight = 1,
fillOpacity = 0.6,
fillColor = ~ pal(Mean),
popup = paste0("This is ",mapTemp$County," County")
) %>%
addLegend(
pal = pal,
values = ~ Mean,
opacity = 1,
title = input$ind
)
mapTemp <- left_join(counties, data58)
View(mapTemp)
View(data58)
View(counties)
runApp('GitHub/CHVIr/CHIViz')
?labelFormat
runApp('GitHub/CHVIr/CHIViz')
?formatNumber
runApp('GitHub/CHVIr/CHIViz')
