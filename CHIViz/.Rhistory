'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(data = foo, x=~round(Mean, 2), y =~reorder(County, Mean),color = ~selRegion, type = "bar", showlegend= FALSE) %>%
add_segments(x = mean(foo$Mean, na.rm=T),
xend = mean(foo$Mean, na.rm=T),
y = first(reorder(foo$County, foo$Mean)),
yend = last(reorder(foo$County, foo$Mean)),
mode = "lines",
opacity = 0.4,
color="red") %>%
layout(title = "county (dark blue) and its region (light blue)" ,
xaxis = list(title = "Counties",
autotick = TRUE,
ticks = "Indicator",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(
title= "Counties"
)
) %>%
config(modeBarButtonsToRemove = list('toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(data = foo, x=~round(Mean, 2), y =~reorder(County, Mean),color = ~selRegion, type = "bar", showlegend= FALSE) %>%
add_segments(x = mean(foo$Mean, na.rm=T),
xend = mean(foo$Mean, na.rm=T),
y = first(reorder(foo$County, foo$Mean)),
yend = last(reorder(foo$County, foo$Mean)),
mode = "lines",
opacity = 0.4,
color="red") %>%
layout(title = "county (dark blue) and its region (light blue)" ,
margin = list(l = 160),
xaxis = list(title = "Counties",
autotick = TRUE,
ticks = "Indicator",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(
title= "Counties"
)
) %>%
config(modeBarButtonsToRemove = list('toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
x = mean(foo$Mean, na.rm = T),
xend = mean(foo$Mean, na.rm = T),
y = first(foo$County, order_by = foo$Mean)),
yend = last(foo$County, order_by = foo$Mean)),
mode = "lines",
opacity = 0.4,
color = "red"
plot_ly(
data = foo,
x =  ~ round(Mean, 2),
y =  ~ reorder(County, Mean),
color = ~ selRegion,
type = "bar",
showlegend = FALSE
) %>%
add_segments(
x = mean(foo$Mean, na.rm = T),
xend = mean(foo$Mean, na.rm = T),
y = first(foo$County, order_by = foo$Mean),
yend = last(foo$County, order_by = foo$Mean),
mode = "lines",
opacity = 0.4,
color = "red"
) %>%
layout(
title = "county (dark blue) and its region (light blue)" ,
margin = list(l = 160),
xaxis = list(
title = "Counties",
autotick = TRUE,
ticks = "Indicator",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Counties")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(
data = foo,
x =  ~ round(Mean, 2),
y =  ~ reorder(County, Mean),
color = ~ selRegion,
type = "bar",
showlegend = FALSE
) %>%
add_segments(
x = mean(foo$Mean, na.rm = T),
xend = mean(foo$Mean, na.rm = T),
y = first(reorder(foo$County, foo$Mean)),
yend = last(reorder(foo$County, foo$Mean)),
mode = "lines",
opacity = 0.4,
color = "red"
) %>%
layout(
title = "county (dark blue) and its region (light blue)" ,
margin = list(l = 160),
xaxis = list(
title = "Counties",
autotick = TRUE,
ticks = "Indicator",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Counties")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
exposure <- "Projected number of extreme heat days"
plot_ly(
data = foo,
x =  ~ round(Mean, 2),
y =  ~ reorder(County, Mean),
color = ~ selRegion,
type = "bar",
showlegend = FALSE
) %>%
layout(
title = "county (dark blue) and its region (light blue)" ,
margin = list(l = 160),
xaxis = list(
title = "Counties",
autotick = TRUE,
ticks = "Indicator",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Counties")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
runApp('GitHub/CHVIr/CHIViz')
runApp('GitHub/CHVIr/CHIViz')
cnty <-"Alameda"
averages <- CHVIdata %>%
filter(metric == "est") %>%
group_by(def, ind, strata) %>%
summarise(stateAverage = mean(value, na.rm=T))
foo <- CHVIdata %>% filter(county == cnty & metric == "est") %>%
left_join(averages) %>%
mutate(label = paste0(def," - ", strata),
ratio = value/stateAverage,
category = ifelse(ratio < 0.9, "below CA average",
ifelse(ratio > 1.1, "above CA average","around CA average"))) %>%
ggplot() +
geom_bar(aes(x=reorder(label, ratio), y=ratio, fill=category), stat="identity") +
coord_flip() +
geom_hline(yintercept = 1, linetype="dashed") +
xlab("Indicator and Strata") +
ylab("Ratio to State Average") +
scale_fill_discrete(name="")
foo <- CHVIdata %>% filter(county == cnty & metric == "est") %>%
left_join(averages) %>%
mutate(label = paste0(def," - ", strata),
ratio = value/stateAverage,
category = ifelse(ratio < 0.9, "below CA average",
ifelse(ratio > 1.1, "above CA average","around CA average")))
plot_ly(
data = foo,
x =  ~ round(ratio,1),
y =  ~ reorder(label, ratio),
color = ~ category,
type = "bar",
showlegend = FALSE
) %>%
layout(
title = "county (dark blue) and its region (light blue)" ,
margin = list(l = 160),
xaxis = list(
title = "Ratio to State Average",
autotick = TRUE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Indicator and Strata")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(
data = foo,
x =  ~ round(ratio,1),
y =  ~ reorder(label, ratio),
color = ~ category,
type = "bar",
showlegend = FALSE
) %>%
layout(margin = list(l = 300),
xaxis = list(
title = "Ratio to State Average",
autotick = TRUE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Indicator and Strata")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(
data = foo,
x =  ~ round(ratio,1),
y =  ~ reorder(label, ratio),
color = ~ category,
type = "bar",
showlegend = FALSE
) %>%
layout(margin = list(l = 400),
xaxis = list(
title = "Ratio to State Average",
autotick = TRUE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Indicator and Strata")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(
data = foo,
x =  ~ round(ratio,1),
y =  ~ reorder(label, ratio),
color = ~ category,
type = "bar",
showlegend = FALSE
) %>%
layout(margin = list(l = 500),
xaxis = list(
title = "Ratio to State Average",
autotick = TRUE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Indicator and Strata")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(
data = foo,
x =  ~ round(ratio,1),
y =  ~ reorder(label, ratio),
color = ~ category,
type = "bar",
showlegend = FALSE
) %>%
layout(margin = list(l = 700),
xaxis = list(
title = "Ratio to State Average",
autotick = TRUE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Indicator and Strata")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(
data = foo,
x =  ~ round(ratio,1),
y =  ~ reorder(label, ratio),
color = ~ category,
type = "bar",
showlegend = FALSE
) %>%
layout(margin = list(l = 650),
xaxis = list(
title = "Ratio to State Average",
autotick = TRUE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Indicator and Strata")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
plot_ly(
data = foo,
x =  ~ round(ratio,2),
y =  ~ reorder(label, ratio),
color = ~ category,
type = "bar",
showlegend = FALSE
) %>%
layout(margin = list(l = 650),
xaxis = list(
title = "Ratio to State Average",
autotick = TRUE,
ticks = "outside",
tick0 = 0,
dtick = 0.25,
ticklen = 5,
tickwidth = 2,
tickcolor = toRGB("black")
),
yaxis = list(title = "Indicator and Strata")
) %>%
config(
modeBarButtonsToRemove = list(
'toggleSpikelines',
'sendDataToCloud',
'hoverCompareCartesian',
'zoom2d',
'pan2d',
'select2d',
'lasso2d',
'zoomIn2d',
'zoomOut2d',
'autoScale2d',
'resetScale2d',
'hoverClosestCartesian'
)
)
runApp('GitHub/CHVIr/CHIViz')
